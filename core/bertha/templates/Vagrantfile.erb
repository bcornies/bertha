# -*- mode: ruby -*-
# vi: set ft=ruby :

required_plugins = [
  'vagrant-triggers',
]

required_plugins.each do |plugin|
  unless Vagrant.has_plugin?(plugin)
    raise "#{plugin} is not installed. Run `vagrant plugin install #{plugin}` before proceeding."
  end
end

# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!
VAGRANTFILE_API_VERSION = '2'

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|

  config.vm.box_url = 'http://puppet-vagrant-boxes.puppetlabs.com/centos-65-x64-virtualbox-puppet.box'
  config.vm.box = 'centos-65-x64-virtualbox-puppet'

  config.vm.network 'public_network', bridge: '<%= scope['bertha::server_network'] %>', ip: '<%= scope['bertha::server_ip'] %>'
  config.vm.hostname = '<%= scope['bertha::server_name'] %>'

  config.vm.synced_folder '.', '<%= scope['bertha::cms_props']['install_dir'] %>/<%= scope['bertha::cms_props']['themes_dir'] %>/<%= scope['::website'] %>'
  config.vm.synced_folder 'content/uploads', '<%= scope['bertha::cms_props']['install_dir'] %>/<%= scope['bertha::cms_props']['uploads_dir'] %>'
  config.vm.synced_folder 'plugins', '<%= scope['bertha::cms_props']['install_dir'] %>/<%= scope['bertha::cms_props']['plugins_dir'] %>'  

  config.trigger.before [:up, :provision] do
    run "bash -c 'cd server ; librarian-puppet install'"
  end

  config.vm.provision 'puppet' do |puppet|
		puppet.manifests_path = 'server/manifests'
		puppet.module_path    = 'server/modules'
		puppet.manifest_file  = 'site.pp'
  end

end
