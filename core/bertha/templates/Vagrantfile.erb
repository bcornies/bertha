# -*- mode: ruby -*-
# vi: set ft=ruby :

ip_address = '<%= scope['bertha::server_ip'] %>'
puts "You can view your website at http://#{ip_address}"

required_plugins = [
  'vagrant-librarian-puppet',
]

required_plugins.each do |plugin|
  unless Vagrant.has_plugin?(plugin)
    raise "#{plugin} is not installed. Run `vagrant plugin install #{plugin}` before proceeding."
  end
end

# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!
VAGRANTFILE_API_VERSION = '2'

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|

  config.vm.box = 'puppetlabs/centos-6.6-64-puppet'

  config.vm.network 'public_network', bridge: '<%= scope['bertha::server_network'] %>', ip: ip_address
  config.vm.hostname = '<%= scope['bertha::server_name'] %>'

  config.vm.synced_folder '<%= scope['bertha::cms_props']['themes_dir'] %>', '<%= scope['bertha::cms_props']['install_dir'] %>/<%= scope['bertha::cms_props']['themes_dir'] %>'#, owner: 'apache', group: 'apache'
  config.vm.synced_folder '<%= scope['bertha::cms_props']['uploads_dir'] %>', '<%= scope['bertha::cms_props']['install_dir'] %>/<%= scope['bertha::cms_props']['uploads_dir'] %>'#, owner: 'apache', group: 'apache'
  config.vm.synced_folder '<%= scope['bertha::cms_props']['plugins_dir'] %>', '<%= scope['bertha::cms_props']['install_dir'] %>/<%= scope['bertha::cms_props']['plugins_dir'] %>'#, owner: 'apache', group: 'apache'

  config.librarian_puppet.puppetfile_dir = 'server/environments/dev'

  config.vm.provision 'puppet', run: 'always' do |puppet|
    puppet.environment      = 'dev'
    puppet.environment_path = 'server/environments'
    puppet.options = [
      # '--debug',
    ]
  end

end
